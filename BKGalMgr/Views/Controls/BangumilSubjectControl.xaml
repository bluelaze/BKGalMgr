<?xml version="1.0" encoding="utf-8" ?>
<UserControl x:Class="BKGalMgr.Views.Controls.BangumiSubjectControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:bangumi="using:BKGalMgr.Models.Bangumi"
             xmlns:converters="using:BKGalMgr.Converters"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="using:BKGalMgr.Views.Controls"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:mcontrols="using:CommunityToolkit.WinUI.Controls"
             mc:Ignorable="d">
    <UserControl.Resources>
        <converters:ObjectToVisibilityConverter x:Key="FocusStateToVisibilityConverter" To="Unfocused" />
    </UserControl.Resources>
    <Grid>
        <StackPanel>
            <AutoSuggestBox x:Name="search_game_AutoSuggestBox"
                            x:Uid="Bangumi_Search_Game"
                            MinWidth="256"
                            Margin="0,12,0,24"
                            HorizontalAlignment="Center"
                            QueryIcon="Find"
                            QuerySubmitted="search_game_AutoSuggestBox_QuerySubmitted"
                            Visibility="{x:Bind HideSearch, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=True}" />
            <mcontrols:SettingsCard x:Uid="Bangumi_Game_Access_Token" Header="Access Token">
                <local:HeaderedTextBox CanEmpty="False"
                                       HeaderWidth="0"
                                       Text="{x:Bind AccessToken, Mode=TwoWay}" />
            </mcontrols:SettingsCard>
            <mcontrols:SettingsCard x:Uid="Bangumi_Game_Subject_Url">
                <Grid MinWidth="256" MaxWidth="600">
                    <TextBox x:Name="subject_url_TextBox"
                             PlaceholderText="https://bangumi.tv/subject/113290"
                             Text="{x:Bind SubjectUrl, Mode=TwoWay}" />
                    <Button x:Name="add_width_subject_url_Button"
                            Width="32"
                            Height="32"
                            Padding="0"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            Background="Transparent"
                            BorderBrush="Transparent"
                            Click="add_width_subject_url_Button_Click"
                            IsEnabled="{x:Bind subject_url_TextBox.Text, Mode=OneWay, Converter={StaticResource EmptyStringToBoolConverter}}"
                            Visibility="{x:Bind subject_url_TextBox.FocusState, Mode=OneWay, Converter={StaticResource FocusStateToVisibilityConverter}}">
                        <Button.Resources>
                            <SolidColorBrush x:Key="ButtonBackgroundDisabled" Color="Transparent" />
                            <SolidColorBrush x:Key="ButtonBorderBrushDisabled" Color="Transparent" />
                        </Button.Resources>
                        <FontIcon FontSize="16" Glyph="&#xE948;" />
                    </Button>
                </Grid>
            </mcontrols:SettingsCard>

            <ListView x:Name="search_result_ListView"
                      MaxHeight="530"
                      Margin="-4,0,-4,0"
                      Padding="0"
                      SelectionMode="None">
                <ListView.ItemContainerStyle>
                    <Style BasedOn="{StaticResource CustomListViewItemStyle}" TargetType="ListViewItem">
                        <Setter Property="Padding" Value="4,2,4,2" />
                    </Style>
                </ListView.ItemContainerStyle>
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="bangumi:Subject">
                        <Grid Padding="4,4,10,4"
                              Background="Transparent"
                              ColumnSpacing="16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Image MinWidth=" 78"
                                   MaxWidth="78"
                                   Margin="0"
                                   VerticalAlignment="Top"
                                   Source="{Binding images.small}">
                                <ToolTipService.ToolTip>
                                    <ToolTip MaxWidth="1920"
                                             MaxHeight="1080"
                                             Placement="Right">
                                        <ToolTip.Content>
                                            <Image Source="{Binding images.large}" Stretch="None" />
                                        </ToolTip.Content>
                                    </ToolTip>
                                </ToolTipService.ToolTip>
                            </Image>

                            <StackPanel Grid.Column="1"
                                        Padding="0"
                                        Spacing="6">

                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <TextBlock Text="{x:Bind name, Mode=OneTime}" />
                                    <TextBlock VerticalAlignment="Center"
                                               FontSize="10"
                                               Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                               Text="{x:Bind name_cn, Mode=OneTime}" />
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Spacing="0">
                                    <TextBlock Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Text="{x:Bind date}" />
                                    <TextBlock Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Text="{x:Bind platform, Mode=OneTime, Converter={StaticResource StringFormatConverter}, ConverterParameter='{}/{0}'}"
                                               Visibility="{x:Bind platform, Mode=OneTime, Converter={StaticResource EmptyStringToVisibilityConverter}}" />
                                    <mcontrols:SwitchPresenter Value="{x:Bind type, Mode=OneTime, Converter={StaticResource StringFormatConverter}, ConverterParameter='{}{0}'}">
                                        <mcontrols:Case Value="1">
                                            <TextBlock Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       Text="/Book" />
                                        </mcontrols:Case>
                                        <mcontrols:Case Value="2">
                                            <TextBlock Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       Text="/Animation" />
                                        </mcontrols:Case>
                                        <mcontrols:Case Value="3">
                                            <TextBlock Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       Text="/Music" />
                                        </mcontrols:Case>
                                        <mcontrols:Case Value="4">
                                            <TextBlock Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       Text="/Game" />
                                        </mcontrols:Case>
                                        <mcontrols:Case Value="6">
                                            <TextBlock Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       Text="/Teriteri" />
                                        </mcontrols:Case>
                                    </mcontrols:SwitchPresenter>

                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <Viewbox Width="128">
                                        <RatingControl Caption="{x:Bind rating.score}"
                                                       IsReadOnly="True"
                                                       Value="{x:Bind local:BangumiSubjectControl.ToRatingValue(rating.score)}" />
                                    </Viewbox>

                                    <TextBlock VerticalAlignment="Center"
                                               Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Text="{x:Bind rating.total, Mode=OneTime, Converter={StaticResource StringFormatConverter}, ConverterParameter='{}{0}人评分'}" />
                                </StackPanel>
                            </StackPanel>
                            <Grid Grid.Column="2">
                                <Grid.RowDefinitions>
                                    <RowDefinition />
                                    <RowDefinition />
                                </Grid.RowDefinitions>
                                <TextBlock Style="{StaticResource CaptionTextBlockStyle}"
                                           Text="{x:Bind rating.rank, Mode=OneTime, Converter={StaticResource StringFormatConverter}, ConverterParameter='{}Rank {0}'}"
                                           Visibility="{x:Bind rating.rank, Converter={StaticResource DoubleToVisibilityConverter}}" />
                                <Button x:Name="add_subject_Button"
                                        Grid.RowSpan="2"
                                        Width="32"
                                        Height="32"
                                        Margin="8,0"
                                        Padding="0"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center"
                                        Background="Transparent"
                                        BorderBrush="Transparent"
                                        Click="add_subject_Button_Click">
                                    <FontIcon FontSize="16" Glyph="&#xE948;" />
                                </Button>
                            </Grid>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </StackPanel>

        <ContentPresenter x:Name="loading_ContentPresenter"
                          Background="Transparent"
                          Visibility="Collapsed">
            <ProgressBar HorizontalAlignment="Stretch"
                         VerticalAlignment="Top"
                         IsIndeterminate="True"
                         ShowPaused="False" />
        </ContentPresenter>
    </Grid>
</UserControl>
